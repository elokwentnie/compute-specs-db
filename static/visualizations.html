<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizations â€” Compute Specs DB</title>
    <meta name="description" content="Interactive charts and comparisons of server CPU and GPU performance metrics. Compare Intel Xeon vs AMD EPYC, NVIDIA vs AMD GPUs by cores, frequency, TDP, memory, and more.">
    <link rel="canonical" href="https://computespecsdb.com/visualizations">
    <link rel="icon" type="image/png" href="/static/images/server-logo.png">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Compute Specs DB">
    <meta property="og:title" content="CPU Visualizations â€” Compute Specs DB">
    <meta property="og:description" content="Interactive charts and comparisons of server CPU performance metrics. Compare Intel Xeon vs AMD EPYC by cores, frequency, TDP, and more.">
    <meta property="og:url" content="https://computespecsdb.com/visualizations">
    <meta property="og:image" content="https://computespecsdb.com/static/images/server-logo.png">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="CPU Visualizations â€” Compute Specs DB">
    <meta name="twitter:description" content="Interactive charts and comparisons of server CPU performance metrics.">

    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link rel="stylesheet" href="/static/css/common.css">
    <link rel="stylesheet" href="/static/css/visualizations.css">
</head>
<body>
    <div class="header">
        <h1>ðŸ“Š Compute Specs DB Visualizations</h1>
        <p>Interactive charts and analysis of CPU and GPU performance metrics</p>
    </div>

    <nav class="nav">
        <a href="/">ðŸ“‹ Table View</a>
        <a href="/visualizations">ðŸ“Š Visualizations</a>
        <a href="/docs">ðŸ“š API Docs</a>
    </nav>

    <main class="container">
        <div class="controls" style="margin-bottom:1.5rem;">
            <div class="controls-grid">
                <div class="control-group">
                    <label for="dataSource">Data Source</label>
                    <select id="dataSource">
                        <option value="cpu">CPUs</option>
                        <option value="gpu">GPUs</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="stats" id="stats">
            <div class="stat-card" id="statTotal">
                <div class="stat-value" id="totalItems">-</div>
                <div class="stat-label" id="totalLabel">Total CPUs</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgTdp">-</div>
                <div class="stat-label">Avg TDP (W)</div>
            </div>
            <div class="stat-card" id="statCores">
                <div class="stat-value" id="stat3">-</div>
                <div class="stat-label" id="stat3Label">Avg Cores</div>
            </div>
            <div class="stat-card" id="statFreq">
                <div class="stat-value" id="stat4">-</div>
                <div class="stat-label" id="stat4Label">Avg Frequency (GHz)</div>
            </div>
        </div>

        <div class="controls">
            <div class="controls-grid">
                <div class="control-group">
                    <label for="xAxis">X-Axis Parameter</label>
                    <select id="xAxis">
                    </select>
                </div>

                <div class="control-group">
                    <label for="yAxis">Y-Axis Parameter</label>
                    <select id="yAxis">
                    </select>
                </div>

                <div class="control-group">
                    <label for="chartType">Chart Type</label>
                    <select id="chartType">
                        <option value="scatter">Scatter Plot</option>
                        <option value="bar">Bar Chart</option>
                        <option value="box">Box Plot</option>
                    </select>
                </div>

            </div>

        </div>

        <div class="filters-section">
            <h3>ðŸ“Š Filters</h3>
            <div class="filter-group" id="familyFilterGroup">
                <label id="filterGroupLabel1">Filter by Family:</label>
                <div class="filter-actions">
                    <button class="filter-action-btn" onclick="selectAllFilters('family')">Select All</button>
                </div>
                <div class="filter-checkbox-group" id="familyFilters">
                    <div class="loading">Loading...</div>
                </div>
            </div>
            <div class="filter-group" id="codenameFilterGroup">
                <label id="filterGroupLabel2">Filter by Codename:</label>
                <div class="filter-actions">
                    <button class="filter-action-btn" onclick="selectAllFilters('codename')">Select All</button>
                </div>
                <div class="filter-checkbox-group" id="codenameFilters">
                    <div class="loading">Loading...</div>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title" id="chartTitle">Loading data...</div>
                <button id="downloadChart" class="download-btn hidden">
                    <span>ðŸ’¾</span>
                    <span>Download Chart</span>
                </button>
            </div>
            <div id="barLimitGroup" class="bar-limit-group hidden">
                <label for="barLimit">Number of CPUs to Display:</label>
                <input type="number" id="barLimit" min="5" max="100" value="25">
            </div>
            <div id="chart">
                <div class="loading">Loading chart data...</div>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title text-center" id="comparisonTitle">CPU Comparison Tool</div>
            <div class="comparison-controls">
                <div class="comparison-selectors">
                    <div class="comparison-selector">
                        <label for="cpu1Select" id="compare1Label">CPU 1</label>
                        <select id="cpu1Select">
                            <option value="">Select...</option>
                        </select>
                    </div>
                    <div class="comparison-selector">
                        <label for="cpu2Select" id="compare2Label">CPU 2</label>
                        <select id="cpu2Select">
                            <option value="">Select...</option>
                        </select>
                    </div>
                </div>
                <div class="compare-btn-container">
                    <button id="compareButton" class="compare-btn" disabled>
                        Compare
                    </button>
                </div>
            </div>
            <div id="comparisonResult" class="hidden">
                <div class="comparison-download-row">
                    <button id="downloadComparison" class="download-btn">
                        <span>ðŸ’¾</span>
                        <span>Download Comparison</span>
                    </button>
                </div>
                <div class="comparison-table-container">
                    <table class="comparison-table" id="comparisonTable">
                        <thead>
                            <tr>
                                <th>Specification</th>
                                <th id="cpu1NameHeader">CPU 1</th>
                                <th id="cpu2NameHeader">CPU 2</th>
                                <th>Difference</th>
                            </tr>
                        </thead>
                        <tbody id="comparisonBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <footer class="data-footer">
        <p class="data-footer-title">Data Validation</p>
        <p>All specifications have been manually validated against official manufacturer sources:</p>
        <div class="data-footer-sources">
            <a href="https://www.intel.com/content/www/us/en/products/overview.html" target="_blank" rel="noopener">Intel</a>
            <a href="https://www.amd.com/en/products/specifications/processors.html" target="_blank" rel="noopener">AMD</a>
            <a href="https://www.techpowerup.com/" target="_blank" rel="noopener">TechPowerUp</a>
            <a href="https://www.cpubenchmark.net/" target="_blank" rel="noopener">PassMark</a>
        </div>
        <p>Found an error? <a href="https://github.com/elokwentnie/compute-specs-db/issues/new?template=report-data-error.yml" target="_blank" rel="noopener">Report it on GitHub</a> | <a href="https://github.com/elokwentnie/compute-specs-db/issues/new?template=new-cpu-request.yml" target="_blank" rel="noopener">Suggest a new CPU</a></p>
    </footer>

    <footer class="site-footer">
        <div class="site-footer-inner">
            <div class="site-footer-top">
                <span class="site-footer-brand">Compute Specs DB</span>
                <nav class="site-footer-links">
                    <a href="/">Data Table</a>
                    <a href="/visualizations">Visualizations</a>
                    <a href="/docs" target="_blank">API Docs</a>
                    <a href="https://github.com/elokwentnie/compute-specs-db" target="_blank" rel="noopener">GitHub</a>
                    <a href="https://github.com/elokwentnie/compute-specs-db/issues/new/choose" target="_blank" rel="noopener">Contribute</a>
                </nav>
            </div>
            <hr class="site-footer-divider">
            <div class="site-footer-bottom">
                <span class="site-footer-disclaimer">Intel, Xeon, and Core are trademarks of Intel Corporation. AMD, EPYC, Ryzen, and Instinct are trademarks of Advanced Micro Devices, Inc. NVIDIA, H100, H200, B100, B200, L4, L40, L40S, and T4 are trademarks of NVIDIA Corporation. All other trademarks are the property of their respective owners. Data is provided "as-is" for informational purposes only, without warranty of any kind.</span>
                <span>&copy; 2026 Compute Specs DB &middot; Open Source</span>
            </div>
        </div>
    </footer>

    <script>
        let allData = [];
        let filteredData = [];
        let activeFilter1 = new Set();
        let activeFilter2 = new Set();
        let dataSource = 'cpu';

        const cpuAxisOptions = [
            { value: 'tdp_watts', label: 'TDP (W)' },
            { value: 'max_turbo_frequency_ghz', label: 'Max Turbo Frequency (GHz)' },
            { value: 'cores', label: 'Cores' },
            { value: 'threads', label: 'Threads' },
            { value: 'l3_cache_mb', label: 'L3 Cache (MB)' },
            { value: 'max_memory_tb', label: 'Max Memory (TB)' },
            { value: 'launch_year', label: 'Launch Year' }
        ];

        const gpuAxisOptions = [
            { value: 'tdp_watts', label: 'TDP (W)' },
            { value: 'memory_gb', label: 'Memory (GB)' }
        ];

        function populateAxisSelectors() {
            const xSelect = document.getElementById('xAxis');
            const ySelect = document.getElementById('yAxis');
            const options = dataSource === 'cpu' ? cpuAxisOptions : gpuAxisOptions;

            xSelect.innerHTML = '';
            ySelect.innerHTML = '';
            options.forEach(opt => {
                xSelect.innerHTML += `<option value="${opt.value}">${opt.label}</option>`;
                ySelect.innerHTML += `<option value="${opt.value}">${opt.label}</option>`;
            });

            if (dataSource === 'cpu') {
                xSelect.value = 'tdp_watts';
                ySelect.value = 'max_turbo_frequency_ghz';
            } else {
                xSelect.value = 'memory_gb';
                ySelect.value = 'tdp_watts';
            }
        }

        function getGroupKey() { return dataSource === 'cpu' ? 'family' : 'vendor'; }
        function getSecondaryKey() { return dataSource === 'cpu' ? 'codename' : 'memory_type'; }
        function getNameKey() { return dataSource === 'cpu' ? 'cpu_model_name' : 'gpu_model_name'; }

        async function loadData() {
            try {
                const endpoint = dataSource === 'cpu' ? '/api/cpus?limit=1000' : '/api/gpus?limit=1000';
                const response = await fetch(endpoint);
                allData = await response.json();
                filteredData = allData;

                updateStats();
                setupFilters();
                updateChart();
                populateComparisonDropdowns();
            } catch (error) {
                document.getElementById('chart').innerHTML =
                    '<div class="error">Error loading data: ' + error.message + '</div>';
            }
        }

        function updateStats() {
            const nameKey = getNameKey();
            const isCpu = dataSource === 'cpu';

            document.getElementById('totalLabel').textContent = isCpu ? 'Total CPUs' : 'Total GPUs';
            document.getElementById('totalItems').textContent = filteredData.length;

            const withTdp = filteredData.filter(d => d.tdp_watts);
            const avgTdp = withTdp.length > 0
                ? (withTdp.reduce((s, d) => s + d.tdp_watts, 0) / withTdp.length).toFixed(1)
                : '-';
            document.getElementById('avgTdp').textContent = avgTdp;

            if (isCpu) {
                document.getElementById('stat3Label').textContent = 'Avg Cores';
                const withCores = filteredData.filter(d => d.cores);
                document.getElementById('stat3').textContent = withCores.length > 0
                    ? (withCores.reduce((s, d) => s + d.cores, 0) / withCores.length).toFixed(1)
                    : '-';

                document.getElementById('stat4Label').textContent = 'Avg Frequency (GHz)';
                const withFreq = filteredData.filter(d => d.max_turbo_frequency_ghz);
                document.getElementById('stat4').textContent = withFreq.length > 0
                    ? (withFreq.reduce((s, d) => s + d.max_turbo_frequency_ghz, 0) / withFreq.length).toFixed(2)
                    : '-';
            } else {
                document.getElementById('stat3Label').textContent = 'Avg Memory (GB)';
                const withMem = filteredData.filter(d => d.memory_gb);
                document.getElementById('stat3').textContent = withMem.length > 0
                    ? (withMem.reduce((s, d) => s + d.memory_gb, 0) / withMem.length).toFixed(0)
                    : '-';

                document.getElementById('stat4Label').textContent = 'GPU Vendors';
                const vendors = new Set(filteredData.map(d => d.vendor).filter(Boolean));
                document.getElementById('stat4').textContent = vendors.size || '-';
            }
        }

        function setupFilters() {
            const groupKey = getGroupKey();
            const secondaryKey = getSecondaryKey();

            const groups = [...new Set(allData.map(d => d[groupKey]).filter(Boolean))].sort();
            const secondaries = [...new Set(allData.map(d => d[secondaryKey]).filter(Boolean))].sort();

            document.getElementById('filterGroupLabel1').textContent =
                dataSource === 'cpu' ? 'Filter by Family:' : 'Filter by Vendor:';
            document.getElementById('filterGroupLabel2').textContent =
                dataSource === 'cpu' ? 'Filter by Codename:' : 'Filter by Memory Type:';

            activeFilter1.clear();
            activeFilter2.clear();

            const container1 = document.getElementById('familyFilters');
            container1.innerHTML = '';
            groups.forEach(val => {
                const item = document.createElement('div');
                item.className = 'filter-checkbox-item';
                const cb = document.createElement('input');
                cb.type = 'checkbox';
                cb.id = `filter1-${val.replace(/\s+/g, '-')}`;
                cb.checked = true;
                cb.dataset.type = 'family';
                cb.dataset.value = val;
                cb.addEventListener('change', e => toggleFilter('family', val, e.target.checked));
                const lbl = document.createElement('label');
                lbl.htmlFor = cb.id;
                lbl.textContent = val;
                item.appendChild(cb);
                item.appendChild(lbl);
                container1.appendChild(item);
                activeFilter1.add(val);
            });

            const container2 = document.getElementById('codenameFilters');
            container2.innerHTML = '';
            secondaries.forEach(val => {
                const item = document.createElement('div');
                item.className = 'filter-checkbox-item';
                const cb = document.createElement('input');
                cb.type = 'checkbox';
                cb.id = `filter2-${val.replace(/\s+/g, '-')}`;
                cb.checked = true;
                cb.dataset.type = 'codename';
                cb.dataset.value = val;
                cb.addEventListener('change', e => toggleFilter('codename', val, e.target.checked));
                const lbl = document.createElement('label');
                lbl.htmlFor = cb.id;
                lbl.textContent = val;
                item.appendChild(cb);
                item.appendChild(lbl);
                container2.appendChild(item);
                activeFilter2.add(val);
            });
        }

        function toggleFilter(type, value, checked) {
            const set = type === 'family' ? activeFilter1 : activeFilter2;
            checked ? set.add(value) : set.delete(value);
            applyFilters();
        }

        window.selectAllFilters = function(type) {
            const container = type === 'family'
                ? document.getElementById('familyFilters')
                : document.getElementById('codenameFilters');
            if (!container) return;
            const set = type === 'family' ? activeFilter1 : activeFilter2;
            container.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = true;
                set.add(cb.dataset.value);
            });
            applyFilters();
        };

        window.selectNoneFilters = function(type) {
            const container = type === 'family'
                ? document.getElementById('familyFilters')
                : document.getElementById('codenameFilters');
            if (!container) return;
            const set = type === 'family' ? activeFilter1 : activeFilter2;
            container.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
                set.delete(cb.dataset.value);
            });
            applyFilters();
        };

        function applyFilters() {
            const groupKey = getGroupKey();
            const secKey = getSecondaryKey();
            filteredData = allData.filter(d => {
                const g = activeFilter1.size === 0 || !d[groupKey] || activeFilter1.has(d[groupKey]);
                const s = activeFilter2.size === 0 || !d[secKey] || activeFilter2.has(d[secKey]);
                return g && s;
            });
            updateStats();
            updateChart();
        }

        const colorPalette = [
            '#0072B2', '#E69F00', '#009E73', '#D55E00',
            '#CC79A7', '#56B4E9', '#F0E442', '#000000'
        ];

        function updateChart() {
            const xAxis = document.getElementById('xAxis').value;
            const yAxis = document.getElementById('yAxis').value;
            const chartType = document.getElementById('chartType').value;
            const xLabel = document.getElementById('xAxis').options[document.getElementById('xAxis').selectedIndex].text;
            const yLabel = document.getElementById('yAxis').options[document.getElementById('yAxis').selectedIndex].text;
            const nameKey = getNameKey();
            const groupKey = getGroupKey();
            const isCpu = dataSource === 'cpu';
            const itemLabel = isCpu ? 'CPU' : 'GPU';

            document.getElementById('chartTitle').textContent = `${yLabel} vs ${xLabel}`;

            const validItems = filteredData.filter(d => d[xAxis] != null && d[yAxis] != null);

            if (validItems.length === 0) {
                document.getElementById('chart').innerHTML =
                    '<div class="error">No data available for selected parameters</div>';
                document.getElementById('downloadChart').classList.add('hidden');
                return;
            }

            document.getElementById('downloadChart').classList.remove('hidden');

            let traces = [];
            let layout = {};
            const isMobile = window.innerWidth <= 768;

            if (chartType === 'scatter') {
                const groups = [...new Set(validItems.map(d => d[groupKey] || 'Unknown'))];
                groups.forEach((group, index) => {
                    const items = validItems.filter(d => (d[groupKey] || 'Unknown') === group);
                    traces.push({
                        x: items.map(d => d[xAxis]),
                        y: items.map(d => d[yAxis]),
                        mode: 'markers',
                        type: 'scatter',
                        name: group,
                        text: items.map(d => d[nameKey]),
                        hovertemplate: '<b>%{text}</b><br>' + xLabel + ': %{x}<br>' + yLabel + ': %{y}<extra></extra>',
                        marker: { size: 14, opacity: 0.8, color: colorPalette[index % colorPalette.length], line: { width: 1.5, color: '#ffffff' } }
                    });
                });
                layout = {
                    title: { text: `${yLabel} vs ${xLabel}`, font: { size: isMobile ? 14 : 18 } },
                    xaxis: { title: xLabel, titlefont: { size: isMobile ? 12 : 14 } },
                    yaxis: { title: yLabel, titlefont: { size: isMobile ? 12 : 14 } },
                    hovermode: 'closest',
                    margin: isMobile ? { l: 50, r: 10, t: 50, b: 100 } : { l: 60, r: 20, t: 60, b: 60 },
                    showlegend: true,
                    legend: isMobile
                        ? { x: 0.5, y: -0.25, xanchor: 'center', yanchor: 'top', orientation: 'h', bgcolor: 'rgba(255,255,255,0.9)', bordercolor: '#e2e8f0', borderwidth: 1, font: { size: 10 }, itemwidth: 20 }
                        : { x: 1.02, y: 1, xanchor: 'left', yanchor: 'top', bgcolor: 'rgba(255,255,255,0.8)', bordercolor: '#e2e8f0', borderwidth: 1 }
                };
            } else if (chartType === 'bar') {
                const barLimit = parseInt(document.getElementById('barLimit').value) || 25;
                const sorted = [...validItems].sort((a, b) => (b[yAxis] || 0) - (a[yAxis] || 0)).slice(0, barLimit);
                const numItems = sorted.length;
                let chartHeight = numItems <= 25 ? 600 : numItems <= 50 ? 600 + (numItems - 25) * 30 : 600 + 25 * 30 + (numItems - 50) * 25;

                const chartEl = document.getElementById('chart');
                chartEl.style.height = chartHeight + 'px';
                chartEl.style.minHeight = chartHeight + 'px';

                const groups = [...new Set(sorted.map(d => d[groupKey] || 'Unknown'))];
                groups.forEach((group, index) => {
                    const items = sorted.filter(d => (d[groupKey] || 'Unknown') === group);
                    if (items.length > 0) {
                        traces.push({
                            x: items.map(d => d[yAxis]),
                            y: items.map(d => d[nameKey]),
                            type: 'bar',
                            orientation: 'h',
                            name: group,
                            marker: { color: colorPalette[index % colorPalette.length], line: { width: 1, color: '#ffffff' } },
                            text: items.map(d => `${xLabel}: ${d[xAxis]}`),
                            hovertemplate: '<b>%{y}</b><br>' + yLabel + ': %{x}<br>%{text}<extra></extra>'
                        });
                    }
                });
                layout = {
                    title: { text: `Top ${sorted.length} ${itemLabel}s by ${yLabel}`, font: { size: isMobile ? 14 : 18 } },
                    xaxis: { title: yLabel, titlefont: { size: isMobile ? 12 : 14 } },
                    yaxis: { title: `${itemLabel} Model`, automargin: true, tickmode: 'linear', tickangle: 0, titlefont: { size: isMobile ? 12 : 14 } },
                    margin: isMobile ? { l: 180, r: 20, t: 50, b: 100 } : { l: 250, r: 150, t: 60, b: 60 },
                    showlegend: true,
                    legend: isMobile
                        ? { x: 0.5, y: -0.25, xanchor: 'center', yanchor: 'top', orientation: 'h', bgcolor: 'rgba(255,255,255,0.9)', bordercolor: '#e2e8f0', borderwidth: 1, font: { size: 10 }, itemwidth: 20 }
                        : { x: 1.02, y: 1, xanchor: 'left', yanchor: 'top', bgcolor: 'rgba(255,255,255,0.8)', bordercolor: '#e2e8f0', borderwidth: 1 },
                    height: chartHeight
                };
            } else if (chartType === 'box') {
                const groups = [...new Set(validItems.map(d => d[groupKey] || 'Unknown'))];
                groups.forEach((group, index) => {
                    const items = validItems.filter(d => (d[groupKey] || 'Unknown') === group);
                    const color = colorPalette[index % colorPalette.length];
                    traces.push({
                        y: items.map(d => d[yAxis]),
                        type: 'box',
                        name: group,
                        boxpoints: 'all',
                        jitter: 0.3,
                        pointpos: -1.8,
                        text: items.map(d => d[nameKey] || 'Unknown'),
                        hovertemplate: '<b>%{text}</b><br>' + yLabel + ': %{y}<extra></extra>',
                        marker: { size: 8, opacity: 0.8, color: color, line: { width: 1, color: '#ffffff' } },
                        line: { color: color, width: 2.5 },
                        fillcolor: color,
                        opacity: 0.6
                    });
                });
                layout = {
                    title: { text: `Distribution of ${yLabel} by ${isCpu ? 'Family' : 'Vendor'}`, font: { size: isMobile ? 14 : 18 } },
                    yaxis: { title: yLabel, titlefont: { size: isMobile ? 12 : 14 } },
                    xaxis: { title: isCpu ? 'Family' : 'Vendor', tickangle: 0, titlefont: { size: isMobile ? 12 : 14 } },
                    margin: isMobile ? { l: 50, r: 10, t: 50, b: 150 } : { l: 60, r: 20, t: 60, b: 100 },
                    showlegend: true,
                    legend: isMobile
                        ? { x: 0.5, y: -0.25, xanchor: 'center', yanchor: 'top', orientation: 'h', bgcolor: 'rgba(255,255,255,0.9)', bordercolor: '#e2e8f0', borderwidth: 1, font: { size: 10 }, itemwidth: 20 }
                        : { x: 1.02, y: 1, xanchor: 'left', yanchor: 'top', bgcolor: 'rgba(255,255,255,0.8)', bordercolor: '#e2e8f0', borderwidth: 1 }
                };
            }

            Plotly.newPlot('chart', traces, layout, {
                responsive: true,
                displayModeBar: !isMobile,
                modeBarButtonsToRemove: ['lasso2d', 'select2d'],
                displaylogo: false
            });

            if (!window.chartResizeHandlerAdded) {
                let resizeTimeout;
                window.addEventListener('resize', () => {
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(() => {
                        const el = document.getElementById('chart');
                        if (el && el.children.length > 0) Plotly.Plots.resize('chart');
                    }, 250);
                });
                window.chartResizeHandlerAdded = true;
            }
        }

        function downloadChart() {
            const xLabel = document.getElementById('xAxis').options[document.getElementById('xAxis').selectedIndex].text;
            const yLabel = document.getElementById('yAxis').options[document.getElementById('yAxis').selectedIndex].text;
            const chartType = document.getElementById('chartType').value;
            const typeName = chartType === 'bar' ? 'Bar' : chartType === 'scatter' ? 'Scatter' : 'Box';
            const prefix = dataSource === 'cpu' ? 'CPU' : 'GPU';
            const filename = `${prefix}_${typeName}_${yLabel.replace(/[^a-zA-Z0-9]/g, '_')}_vs_${xLabel.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.png`;
            Plotly.downloadImage('chart', { format: 'png', width: 1200, height: 800, filename });
        }

        document.getElementById('downloadChart').addEventListener('click', downloadChart);
        document.getElementById('downloadComparison').addEventListener('click', downloadComparisonTable);

        function populateComparisonDropdowns() {
            const s1 = document.getElementById('cpu1Select');
            const s2 = document.getElementById('cpu2Select');
            const nameKey = getNameKey();
            const isCpu = dataSource === 'cpu';
            const label = isCpu ? 'CPU' : 'GPU';

            document.getElementById('comparisonTitle').textContent = `${label} Comparison Tool`;
            document.getElementById('compare1Label').textContent = `${label} 1`;
            document.getElementById('compare2Label').textContent = `${label} 2`;

            s1.innerHTML = `<option value="">Select ${label}...</option>`;
            s2.innerHTML = `<option value="">Select ${label}...</option>`;

            const sorted = [...allData].sort((a, b) => (a[nameKey] || '').localeCompare(b[nameKey] || ''));
            sorted.forEach(item => {
                const extra = isCpu && item.codename ? ` (${item.codename})` : (!isCpu && item.vendor ? ` (${item.vendor})` : '');
                const text = `${item[nameKey]}${extra}`;
                s1.innerHTML += `<option value="${item.id}">${text}</option>`;
                s2.innerHTML += `<option value="${item.id}">${text}</option>`;
            });
        }

        function compareItems() {
            const id1 = parseInt(document.getElementById('cpu1Select').value);
            const id2 = parseInt(document.getElementById('cpu2Select').value);
            if (!id1 || !id2) { alert('Please select both items to compare'); return; }
            if (id1 === id2) { alert('Please select two different items to compare'); return; }
            const item1 = allData.find(d => d.id === id1);
            const item2 = allData.find(d => d.id === id2);
            if (!item1 || !item2) { alert('Item not found'); return; }
            displayComparison(item1, item2);
        }

        function getComparisonParams() {
            if (dataSource === 'cpu') {
                return [
                    { key: 'cpu_model_name', label: 'CPU Model Name', type: 'text' },
                    { key: 'codename', label: 'Codename', type: 'text' },
                    { key: 'family', label: 'Family', type: 'text' },
                    { key: 'cpu_model', label: 'CPU Model', type: 'text' },
                    { key: 'cores', label: 'Cores', type: 'number', higher: 'better', format: v => v != null ? v : '-' },
                    { key: 'threads', label: 'Threads', type: 'number', higher: 'better', format: v => v != null ? v : '-' },
                    { key: 'max_turbo_frequency_ghz', label: 'Max Turbo Frequency', type: 'number', higher: 'better', unit: 'GHz', format: v => v ? v.toFixed(2) : '-' },
                    { key: 'l3_cache_mb', label: 'L3 Cache', type: 'number', higher: 'better', unit: 'MB', format: v => v ? v.toFixed(1) : '-' },
                    { key: 'tdp_watts', label: 'TDP', type: 'number', higher: 'worse', unit: 'W', format: v => v || '-' },
                    { key: 'launch_year', label: 'Launch Year', type: 'number', higher: 'better', format: v => v || '-' },
                    { key: 'max_memory_tb', label: 'Max Memory', type: 'number', higher: 'better', unit: 'TB', format: v => v ? v.toFixed(2) : '-' }
                ];
            } else {
                return [
                    { key: 'gpu_model_name', label: 'GPU Model Name', type: 'text' },
                    { key: 'vendor', label: 'Vendor', type: 'text' },
                    { key: 'gpu_model', label: 'GPU Model', type: 'text' },
                    { key: 'form_factor', label: 'Form Factor', type: 'text' },
                    { key: 'memory_gb', label: 'Memory', type: 'number', higher: 'better', unit: 'GB', format: v => v != null ? v : '-' },
                    { key: 'memory_type', label: 'Memory Type', type: 'text' },
                    { key: 'tdp_watts', label: 'TDP', type: 'number', higher: 'worse', unit: 'W', format: v => v || '-' }
                ];
            }
        }

        function displayComparison(item1, item2) {
            const nameKey = getNameKey();
            const name1 = item1[nameKey] || 'Item 1';
            const name2 = item2[nameKey] || 'Item 2';

            document.getElementById('cpu1NameHeader').textContent = name1;
            document.getElementById('cpu2NameHeader').textContent = name2;

            const body = document.getElementById('comparisonBody');
            body.innerHTML = '';
            const parameters = getComparisonParams();

            parameters.forEach((param, index) => {
                const row = document.createElement('tr');
                const val1 = item1[param.key];
                const val2 = item2[param.key];
                const rowClass = index % 2 === 0 ? 'row-odd' : 'row-even';
                let diffHtml = '', cell1H = '', cell2H = '';

                if (param.type === 'number' && val1 != null && val2 != null && param.higher) {
                    const diff = val2 - val1;
                    const pct = val1 !== 0 ? ((diff / val1) * 100).toFixed(1) : 0;
                    const fmt = parseFloat(Math.abs(diff).toFixed(2)).toString();
                    if (diff > 0) {
                        const cls = param.higher === 'better' ? 'diff-better' : 'diff-worse';
                        cell2H = param.higher === 'better' ? 'highlight-better' : 'highlight-worse';
                        diffHtml = `<span class="comparison-diff-badge ${cls}">+${fmt}${param.unit ? ' ' + param.unit : ''} (+${Math.abs(pct)}%)</span>`;
                    } else if (diff < 0) {
                        const cls = param.higher === 'better' ? 'diff-worse' : 'diff-better';
                        cell1H = param.higher === 'better' ? 'highlight-worse' : 'highlight-better';
                        diffHtml = `<span class="comparison-diff-badge ${cls}">-${fmt}${param.unit ? ' ' + param.unit : ''} (${pct}%)</span>`;
                    } else {
                        diffHtml = '<span class="comparison-diff-badge diff-same">Same</span>';
                    }
                } else {
                    diffHtml = val1 === val2
                        ? '<span class="comparison-diff-badge diff-same">Same</span>'
                        : '<span class="comparison-diff-badge diff-different">Different</span>';
                }

                const fmt = param.format || (v => v != null ? v : '-');
                const d1 = fmt(val1), d2 = fmt(val2);
                const u1 = (param.unit && d1 !== '-') ? ` ${param.unit}` : '';
                const u2 = (param.unit && d2 !== '-') ? ` ${param.unit}` : '';

                row.innerHTML = `
                    <td class="comparison-label-cell ${rowClass}">${param.label}</td>
                    <td class="comparison-value-cell ${cell1H} ${rowClass}"><span class="comparison-value">${d1}${u1}</span></td>
                    <td class="comparison-value-cell ${cell2H} ${rowClass}"><span class="comparison-value">${d2}${u2}</span></td>
                    <td class="comparison-value-cell ${rowClass}">${diffHtml}</td>
                `;
                body.appendChild(row);
            });

            window.currentComparison = { item1, item2, parameters, nameKey };
            document.getElementById('comparisonResult').classList.remove('hidden');
        }

        function downloadComparisonTable() {
            if (!window.currentComparison) return;
            const { item1, item2, parameters, nameKey } = window.currentComparison;
            const n1 = item1[nameKey] || 'Item 1';
            const n2 = item2[nameKey] || 'Item 2';
            const esc = s => '"' + String(s ?? '').replace(/"/g, '""') + '"';

            let csv = [esc('Specification'), esc(n1), esc(n2), esc('Difference')].join(',') + '\n';
            parameters.forEach(param => {
                const v1 = item1[param.key], v2 = item2[param.key];
                const fmt = param.format || (v => v != null ? v : '-');
                const d1 = fmt(v1), d2 = fmt(v2);
                const u1 = (param.unit && d1 !== '-') ? ` ${param.unit}` : '';
                const u2 = (param.unit && d2 !== '-') ? ` ${param.unit}` : '';
                let diff = 'Different';
                if (param.type === 'number' && v1 != null && v2 != null && param.higher) {
                    const dv = v2 - v1;
                    const pct = v1 !== 0 ? ((dv / v1) * 100).toFixed(1) : 0;
                    const f = parseFloat(Math.abs(dv).toFixed(2)).toString();
                    diff = dv > 0 ? `+${f}${param.unit ? ' ' + param.unit : ''} (+${Math.abs(pct)}%)` : dv < 0 ? `-${f}${param.unit ? ' ' + param.unit : ''} (${pct}%)` : 'Same';
                } else {
                    diff = v1 === v2 ? 'Same' : 'Different';
                }
                csv += [esc(param.label), esc(d1 + u1), esc(d2 + u2), esc(diff)].join(',') + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            const prefix = dataSource === 'cpu' ? 'CPU' : 'GPU';
            link.download = `${prefix}_Comparison_${n1.replace(/[^a-zA-Z0-9]/g, '_')}_vs_${n2.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`;
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        document.getElementById('xAxis').addEventListener('change', updateChart);
        document.getElementById('yAxis').addEventListener('change', updateChart);
        document.getElementById('chartType').addEventListener('change', function() {
            document.getElementById('barLimitGroup').classList.toggle('hidden', this.value !== 'bar');
            updateChart();
        });
        document.getElementById('barLimit').addEventListener('change', updateChart);
        document.getElementById('barLimit').addEventListener('input', updateChart);

        document.getElementById('cpu1Select').addEventListener('change', function() {
            document.getElementById('compareButton').disabled = !this.value || !document.getElementById('cpu2Select').value;
        });
        document.getElementById('cpu2Select').addEventListener('change', function() {
            document.getElementById('compareButton').disabled = !document.getElementById('cpu1Select').value || !this.value;
        });
        document.getElementById('compareButton').addEventListener('click', compareItems);

        document.getElementById('dataSource').addEventListener('change', function() {
            dataSource = this.value;
            populateAxisSelectors();
            document.getElementById('comparisonResult').classList.add('hidden');
            loadData();
        });

        populateAxisSelectors();
        loadData();
    </script>
</body>
</html>

